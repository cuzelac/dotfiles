#!/bin/bash

NAME=$1
BASE=f3f77a7f-e484-4b5f-b61f-073abc46bf17

prlctl clone $BASE --name $1
sleep 5
prlctl start $1

echo "Waiting for $NAME to come up..."
while true; do
  sleep 1
  prlctl exec $NAME id >/dev/null 2>&1 && break
done

echo "Done!  Reconfiguring hostname/network."

prlctl exec $NAME /root/setup.sh $NAME

echo "rebooting VM.  It will be ready once it comes up."
